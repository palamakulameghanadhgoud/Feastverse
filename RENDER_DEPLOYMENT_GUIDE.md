# Feastverse Deployment Guide for Render

This guide will help you deploy Feastverse (backend + frontend) on Render.

## Prerequisites

1. GitHub account with this repository
2. MongoDB Atlas account (already set up)
3. Render account (free): https://render.com/
4. Google OAuth credentials
5. Cloudinary account

## Deployment Options

### Option 1: Automatic Deployment (Using render.yaml) - RECOMMENDED

1. **Push to GitHub**
   ```bash
   git add .
   git commit -m "Add Render deployment configuration"
   git push origin main
   ```

2. **Connect to Render**
   - Go to https://dashboard.render.com/
   - Click "New +" → "Blueprint"
   - Connect your GitHub repository
   - Select the repository: `palamakulameghanadhgoud/Feastverse`
   - Render will automatically detect `render.yaml`
   - Click "Apply"

3. **Configure Environment Variables**
   
   After deployment starts, you'll need to set these environment variables in Render dashboard:

   **For Backend Service (feastverse-backend):**
   ```
   MONGODB_URL=<your-mongodb-atlas-connection-string>
   GOOGLE_CLIENT_ID=<your-google-client-id>
   GOOGLE_CLIENT_SECRET=<your-google-client-secret>
   FRONTEND_URL=https://feastverse-frontend.onrender.com
   CLOUDINARY_CLOUD_NAME=<your-cloudinary-cloud-name>
   CLOUDINARY_API_KEY=<your-cloudinary-api-key>
   CLOUDINARY_API_SECRET=<your-cloudinary-api-secret>
   SMTP_USER=<your-gmail-address>
   SMTP_PASSWORD=<your-gmail-app-password>
   ```
   
   **Note:** Copy these values from your local `.env` file in `backend/.env`

   **For Frontend Service (feastverse-frontend):**
   ```
   VITE_GOOGLE_CLIENT_ID=<your-google-client-id>
   VITE_API_URL=https://feastverse-backend.onrender.com
   ```

4. **Update Google OAuth Redirect URIs**
   - Go to Google Cloud Console: https://console.cloud.google.com/
   - Navigate to APIs & Services → Credentials
   - Edit your OAuth 2.0 Client ID
   - Add authorized JavaScript origins:
     - `https://feastverse-frontend.onrender.com`
   - Add authorized redirect URIs:
     - `https://feastverse-frontend.onrender.com`

5. **Wait for Deployment**
   - Backend: ~5-10 minutes
   - Frontend: ~3-5 minutes

### Option 2: Manual Deployment (Step by Step)

#### Deploy Backend

1. **Create New Web Service**
   - Dashboard → "New +" → "Web Service"
   - Connect your GitHub repo
   - Configure:
     - **Name**: `feastverse-backend`
     - **Region**: Oregon (or nearest)
     - **Branch**: `main`
     - **Root Directory**: `backend`
     - **Runtime**: Python 3
     - **Build Command**: `pip install -r requirements.txt`
     - **Start Command**: `uvicorn app.main:app --host 0.0.0.0 --port $PORT`
     - **Plan**: Free

2. **Add Environment Variables** (same as above)

3. **Add Health Check**
   - Path: `/health`

#### Deploy Frontend

1. **Create New Static Site**
   - Dashboard → "New +" → "Static Site"
   - Connect your GitHub repo
   - Configure:
     - **Name**: `feastverse-frontend`
     - **Branch**: `main`
     - **Root Directory**: `feastverse`
     - **Build Command**: `npm install && npm run build`
     - **Publish Directory**: `dist`

2. **Add Environment Variables** (frontend vars from above)

3. **Configure Redirects**
   - In the "Redirects/Rewrites" section, add:
     - Source: `/*`
     - Destination: `/index.html`
     - Action: Rewrite

## Post-Deployment Steps

### 1. Update Frontend URL in Backend
After frontend is deployed, update the backend's `FRONTEND_URL` environment variable with the actual frontend URL.

### 2. Update Backend URL in Frontend
After backend is deployed, update the frontend's `VITE_API_URL` environment variable with the actual backend URL.

### 3. Test the Application
1. Visit your frontend URL
2. Try signing in with Google
3. Test creating content

## Important Notes

### Free Tier Limitations
- **Backend**: Spins down after 15 minutes of inactivity
- **Cold Start**: First request after spin-down takes 30-60 seconds
- **Monthly Hours**: 750 hours/month free

### MongoDB Atlas
- Make sure your MongoDB Atlas IP whitelist includes `0.0.0.0/0` (allow all)
- Or add Render's IP ranges (check Render documentation)

### SSL/TLS
- Your backend already has the `tlsAllowInvalidCertificates` workaround
- This works on Render's Linux environment

### Keep Services Awake (Optional)
To prevent free tier services from spinning down:
1. Use a service like UptimeRobot: https://uptimerobot.com/
2. Ping your backend every 10 minutes
3. Set up health check for: `https://feastverse-backend.onrender.com/health`

## Environment Variables Reference

### Backend Required Variables
```env
MONGODB_URL=<your-mongodb-atlas-url>
SECRET_KEY=<auto-generated-by-render>
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=43200
GOOGLE_CLIENT_ID=<your-google-client-id>
GOOGLE_CLIENT_SECRET=<your-google-secret>
FRONTEND_URL=https://feastverse-frontend.onrender.com
CLOUDINARY_CLOUD_NAME=<your-cloudinary-name>
CLOUDINARY_API_KEY=<your-cloudinary-key>
CLOUDINARY_API_SECRET=<your-cloudinary-secret>
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=<your-gmail>
SMTP_PASSWORD=<your-gmail-app-password>
EMAILS_FROM_EMAIL=noreply@feastverse.com
EMAILS_FROM_NAME=Feastverse
EMAILS_ENABLED=true
```

### Frontend Required Variables
```env
VITE_GOOGLE_CLIENT_ID=<your-google-client-id>
VITE_API_URL=https://feastverse-backend.onrender.com
```

## Troubleshooting

### Backend Not Starting
1. Check Render logs
2. Verify all environment variables are set
3. Check MongoDB Atlas connection
4. Ensure IP whitelist includes `0.0.0.0/0`

### Frontend Not Loading
1. Check if build succeeded
2. Verify environment variables
3. Check browser console for errors
4. Ensure redirects are configured

### CORS Errors
1. Verify `FRONTEND_URL` in backend matches actual frontend URL
2. Ensure no trailing slashes
3. Check backend logs for CORS headers

### Google OAuth Not Working
1. Verify redirect URIs are added in Google Console
2. Check that `VITE_GOOGLE_CLIENT_ID` matches backend `GOOGLE_CLIENT_ID`
3. Ensure using HTTPS URLs

## URLs After Deployment

- **Backend API**: `https://feastverse-backend.onrender.com`
- **Frontend**: `https://feastverse-frontend.onrender.com`
- **API Docs**: `https://feastverse-backend.onrender.com/docs`
- **Health Check**: `https://feastverse-backend.onrender.com/health`

## Monitoring

- **Render Dashboard**: https://dashboard.render.com/
- **Logs**: Available in Render dashboard for each service
- **Metrics**: CPU, memory, and request metrics in dashboard

## Cost Optimization

Free tier is sufficient for development/portfolio projects. For production:
- Consider upgrading to Starter plan ($7/month per service)
- Reduces cold starts
- Provides better performance
- More monthly hours

## Support

- Render Documentation: https://render.com/docs
- Render Community: https://community.render.com/
- MongoDB Atlas Support: https://www.mongodb.com/cloud/atlas/support

## Next Steps

After successful deployment:
1. Set up custom domain (optional)
2. Configure SSL certificate (automatic on Render)
3. Set up monitoring/alerts
4. Add analytics
5. Set up backup strategy for MongoDB

---

**Need Help?** Check the troubleshooting section or contact Render support through their dashboard.

